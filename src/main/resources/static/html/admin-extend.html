<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Auction Control</title>
    <link rel="stylesheet" href="/css/style.css">
    <style>
        body {
          font-family: 'Segoe UI', sans-serif;
          background-color: #eef2f7;
          padding: 40px;
        }
        h2 {
          color: #0a1f44;
        }
        select, input, button {
          padding: 10px;
          margin: 10px 0;
          width: 100%;
          max-width: 400px;
          font-size: 16px;
        }
        button {
          background-color: #007bff;
          color: white;
          border: none;
          border-radius: 4px;
          font-weight: bold;
          cursor: pointer;
        }
        button:hover {
          background-color: #0056b3;
        }
        .info {
          font-size: 14px;
          color: #555;
          margin-bottom: 10px;
        }
    </style>
</head>
<body>

<h2>Admin: Extend Auction End Time</h2>

<div class="info" id="current-end-time">Select an auction to view current end time</div>
<select id="auction-select">
    <option value="">Loading auctions...</option>
</select>

<input type="datetime-local" id="new-end-time">
<button onclick="extendAuction()">Update End Time</button>

<script>
    const user = JSON.parse(localStorage.getItem("loggedInUser"));
    if (!user || user.role !== "ADMIN") {
      alert("Access denied. Admins only.");
      window.location.href = "/html/login.html";
    }

    const select = document.getElementById("auction-select");
    const currentEndTime = document.getElementById("current-end-time");

    fetch("/api/auctions/all")
      .then(res => res.json())
      .then(data => {
        select.innerHTML = "";
        data.forEach(item => {
          const option = document.createElement("option");
          option.value = item.id;
          option.textContent = `${item.title} — ₹${item.currentBid}`;
          option.dataset.endTime = item.endTime;
          select.appendChild(option);
        });

        select.addEventListener("change", () => {
          const selected = select.options[select.selectedIndex];
          const endTime = selected.dataset.endTime;
          currentEndTime.innerText = `Current End Time: ${new Date(endTime).toLocaleString()}`;
        });
      })
      .catch(err => {
        alert("Failed to load auctions");
        console.error(err);
      });

    function extendAuction() {
      const auctionId = select.value;
      const newEndTime = document.getElementById("new-end-time").value;

      if (!auctionId || !newEndTime) {
        alert("Please select auction and new end time");
        return;
      }

      fetch(`/api/auctions/${auctionId}/extend?newEndTime=${newEndTime}`, {
        method: "PUT"
      })
      .then(res => res.text())
      .then(msg => alert(msg))
      .catch(err => alert("Error: " + err));
    }
</script>

</body>
</html>
